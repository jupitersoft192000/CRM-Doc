!function(t){var e,i,n,o={canvas:!0},r=Object.prototype.hasOwnProperty;t.plot.plugins.push({init:function(o,s){var a=s.Canvas;null==e&&(i=a.prototype.getTextInfo,n=a.prototype.addText,e=a.prototype.render),a.prototype.render=function(){if(!o.getOptions().canvas)return e.call(this);var t=this.context,i=this._textCache;t.save(),t.textBaseline="middle";for(var n in i)if(r.call(i,n)){var s=i[n];for(var a in s)if(r.call(s,a)){var l=s[a],h=!0;for(var f in l)if(r.call(l,f)){var p=l[f],c=p.positions,v=p.lines;h&&(t.fillStyle=p.font.color,t.font=p.font.definition,h=!1);for(var d,g=0;d=c[g];g++)if(d.active)for(var u,y=0;u=d.lines[y];y++)t.fillText(v[y].text,u[0],u[1]);else c.splice(g--,1);0==c.length&&delete l[f]}}}t.restore()},a.prototype.getTextInfo=function(e,n,r,s,a){if(!o.getOptions().canvas)return i.call(this,e,n,r,s,a);var l,h,f,p;if(n=""+n,l="object"==typeof r?r.style+" "+r.variant+" "+r.weight+" "+r.size+"px "+r.family:r,null==(h=this._textCache[e])&&(h=this._textCache[e]={}),null==(f=h[l])&&(f=h[l]={}),null==(p=f[n])){var c=this.context;if("object"!=typeof r){var v=t("<div>&nbsp;</div>").css("position","absolute").addClass("string"==typeof r?r:null).appendTo(this.getTextLayer(e));(r={lineHeight:v.height(),style:v.css("font-style"),variant:v.css("font-variant"),weight:v.css("font-weight"),family:v.css("font-family"),color:v.css("color")}).size=v.css("line-height",1).height(),v.remove()}l=r.style+" "+r.variant+" "+r.weight+" "+r.size+"px "+r.family,p=f[n]={width:0,height:0,positions:[],lines:[],font:{definition:l,color:r.color}},c.save(),c.font=l;for(var d=(n+"").replace(/<br ?\/?>|\r\n|\r/g,"\n").split("\n"),g=0;g<d.length;++g){var u=d[g],y=c.measureText(u);p.width=Math.max(y.width,p.width),p.height+=r.lineHeight,p.lines.push({text:u,width:y.width,height:r.lineHeight})}c.restore()}return p},a.prototype.addText=function(t,e,i,r,s,a,l,h,f){if(!o.getOptions().canvas)return n.call(this,t,e,i,r,s,a,l,h,f);var p=this.getTextInfo(t,r,s,a,l),c=p.positions,v=p.lines;i+=p.height/v.length/2,i="middle"==f?Math.round(i-p.height/2):"bottom"==f?Math.round(i-p.height):Math.round(i),window.opera&&window.opera.version().split(".")[0]<12&&(i-=2);for(var d,g=0;d=c[g];g++)if(d.x==e&&d.y==i)return void(d.active=!0);d={active:!0,lines:[],x:e,y:i},c.push(d);for(var u,g=0;u=v[g];g++)"center"==h?d.lines.push([Math.round(e-u.width/2),i]):"right"==h?d.lines.push([Math.round(e-u.width),i]):d.lines.push([Math.round(e),i]),i+=u.height}},options:o,name:"canvas",version:"1.0"})}(jQuery);